import 'source-map-support'
import { getCacheFromRedis, isInvalidGenericParam, redisSetWithTimestamp } from '@app/util/redis'
import { getZapperApps, formatAndFilterZapperData, getZapperRemainingPoints } from '@app/util/zapper';
import { getNetworkConfigConstants } from '@app/util/networks';
import { isAddress } from 'ethers/lib/utils';

const { F2_MARKETS } = getNetworkConfigConstants();

export default async function handler(req, res) {
  const { escrow, fresh } = req.query;

  if (!escrow || !isAddress(escrow) || isInvalidGenericParam(escrow)) {
    res.status(400).json({ msg: 'invalid request' });
    return;
  }

  const cacheKey = `escrow-rewards-1-${escrow}`;

  //const data = [{ "key": "1022563914", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "lido", "appName": "Lido", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/lido.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:16.348Z", "balanceUSD": 73298.80011205828, "products": [{ "label": "wstETH", "assets": [{ "key": "1185543009", "type": "app-token", "appId": "lido", "groupId": "wsteth", "network": "ethereum", "address": "0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0", "tokens": [{ "key": "32421760", "type": "app-token", "appId": "lido", "price": 1903.4391390615126, "supply": 5913339.775892924, "symbol": "stETH", "tokens": [{ "type": "base-token", "price": 1908.3, "symbol": "ETH", "address": "0x0000000000000000000000000000000000000000", "network": "ethereum", "decimals": 18, "balance": 38.410522513262215, "balanceRaw": "38410522513262216084", "balanceUSD": 73298.80011205828 }], "address": "0xae7ab96520de3a18e5e111b5eaab095312d7fe84", "groupId": "steth", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [5898277.195411531], "liquidity": 11255682372.003824 }, "displayProps": { "label": "stETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 11255682372.003824 } }, { "label": "Share", "value": { "type": "pct", "value": 0.00065121596087656 } }], "secondaryLabel": { "type": "dollar", "value": 1903.4391390615126 } }, "pricePerShare": [0.9974527794694297], "balance": 38.50861244147692, "balanceRaw": "38508612441476920982", "balanceUSD": 73298.80011205828 }], "symbol": "wstETH", "decimals": 18, "supply": 1428462.460933676, "pricePerShare": [1.117561728618529], "price": 2127.2107345697486, "dataProps": { "liquidity": 3038640680.828036, "reserves": [1596394.977107717], "apy": 0 }, "displayProps": { "label": "wstETH", "secondaryLabel": { "type": "dollar", "value": 2127.2107345697486 }, "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 3038640680.828036 } }, { "label": "Share", "value": { "type": "pct", "value": 0.0024122233528475045 } }] }, "balance": 34.45770506930229, "balanceRaw": "34457705069302293719", "balanceUSD": 73298.80011205828 }], "meta": [] }] }, { "key": "2951372991", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "silo-finance", "appName": "Silo Finance", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/silo-finance.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:19.700Z", "balanceUSD": 0, "products": [] }, { "key": "679837204", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "llama-airforce", "appName": "Llama Airforce", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/llama-airforce.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:17.988Z", "balanceUSD": 3397.494296084642, "products": [{ "label": "Vaults", "assets": [{ "key": "2038089596", "type": "app-token", "appId": "llama-airforce", "groupId": "vault", "network": "ethereum", "address": "0x4ebad8dbd4edbd74db0278714fbd67ebc76b89b7", "tokens": [{ "type": "base-token", "network": "ethereum", "address": "0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7", "symbol": "cvxCRV", "decimals": 18, "price": 0.863239, "balance": 3589.82319897951, "balanceRaw": "3589823198979509622537", "balanceUSD": 3098.875388463873 }], "symbol": "ucvxCRV", "decimals": 18, "supply": 3351923.4170349385, "pricePerShare": [1.0421156021052207], "price": 0.8995948302457086, "dataProps": { "liquidity": 3015372.977344161, "reserves": [3493091.6899539535], "apy": 0 }, "displayProps": { "label": "cvxCRV Pounder", "secondaryLabel": { "type": "dollar", "value": 0.8995948302457086 }, "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 3015372.977344161 } }, { "label": "Share", "value": { "type": "pct", "value": 0.10276922330163143 } }] }, "balance": 3444.7456613523104, "balanceRaw": "3444745661352310386701", "balanceUSD": 3098.875388463873 }], "meta": [] }, { "label": "Airdrop", "assets": [{ "key": "3934330665", "type": "contract-position", "appId": "llama-airforce", "groupId": "airdrop", "network": "ethereum", "address": "0x2c5e808fca6d8299ce194e12ed728f0fdbbf06c8", "tokens": [{ "metaType": "claimable", "type": "app-token", "appId": "llama-airforce", "price": 0.8649572397376919, "supply": 4802708.34167105, "symbol": "ucvxCRV", "tokens": [{ "type": "base-token", "price": 0.863239, "symbol": "cvxCRV", "address": "0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7", "network": "ethereum", "decimals": 18, "balance": 345.9284249446199, "balanceRaw": "345928424944619874210", "balanceUSD": 298.6189076207687 }], "address": "0xde2bef0a01845257b4aef2a2eaa48f6eaeafa8b7", "groupId": "vault", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [4812267.924036076], "liquidity": 4154137.350476979 }, "displayProps": { "label": "cvxCRV Pounder", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 4154137.350476979 } }, { "label": "Share", "value": { "type": "pct", "value": 0.00718846976945722 } }], "secondaryLabel": { "type": "dollar", "value": 0.8649572397376919 } }, "pricePerShare": [1.0019904565684497], "key": "2791207693", "balance": 345.24123725622354, "balanceRaw": "0x12b72f441e398f0000", "balanceUSD": 298.6189076207687 }], "dataProps": {}, "displayProps": { "label": "Claimable cvxCRV Pounder", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7.png"], "statsItems": [] }, "balanceUSD": 298.6189076207687 }], "meta": [] }] }, { "key": "2129879363", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "curve", "appName": "Curve", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/curve.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:17.608Z", "balanceUSD": 160.93622835905222, "products": [{ "label": "Pools", "assets": [{ "key": "3869217673", "type": "app-token", "appId": "curve", "groupId": "stable-pool", "network": "ethereum", "address": "0x6c3f90f043a72fa612cbac8115ee7e52bde6e490", "tokens": [{ "type": "base-token", "network": "ethereum", "address": "0x6b175474e89094c44da98b954eedeac495271d0f", "symbol": "DAI", "decimals": 18, "price": 0.998673, "balance": 64.29462104525854, "balanceRaw": "64294621045258545734", "balanceUSD": 64.20930208313148 }, { "type": "base-token", "network": "ethereum", "address": "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48", "symbol": "USDC", "decimals": 6, "price": 0.998615, "balance": 61.565399, "balanceRaw": "61565399", "balanceUSD": 61.480130922385 }, { "type": "base-token", "network": "ethereum", "address": "0xdac17f958d2ee523a2206206994597c13d831ec7", "symbol": "USDT", "decimals": 6, "price": 0.999991, "balance": 35.247112, "balanceRaw": "35247112", "balanceUSD": 35.246794775992 }], "symbol": "3Crv", "decimals": 18, "supply": 421897991.3237883, "pricePerShare": [0.40926995088127793, 0.3918969812127888, 0.22436688680570804], "price": 1.0244459210539945, "dataProps": { "liquidity": 432211676.31252843, "reserves": [172670170.18599665, 165340549.179532, 94659938.8629], "apy": 0.2406430413075863, "fee": 0.01, "volume": 28495543.0894512, "swapAddress": "0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7" }, "displayProps": { "label": "DAI / USDC / USDT", "secondaryLabel": "39% / 38% / 21%", "tertiaryLabel": "0.241% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x6b175474e89094c44da98b954eedeac495271d0f.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xdac17f958d2ee523a2206206994597c13d831ec7.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 432211676.31252843 } }, { "label": "Volume", "value": { "type": "dollar", "value": 28495543.0894512 } }, { "label": "APY", "value": { "type": "pct", "value": 0.2406430413075863 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.01 } }, { "label": "Share", "value": { "type": "pct", "value": 0.000037235511481804724 } }] }, "balance": 157.0958750008727, "balanceRaw": "157095875000872695885", "balanceUSD": 160.93622835905222 }], "meta": [] }] }, { "key": "3306990869", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "votium", "appName": "Votium", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/votium.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:17.366Z", "balanceUSD": 42.16326531507616, "products": [{ "label": "Claimable", "assets": [{ "key": "2419719609", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2", "symbol": "WETH", "decimals": 18, "price": 1908.3, "balance": 0.000274423961932121, "balanceRaw": "0xf9964ec4d159", "balanceUSD": 0.5236832465550665 }], "dataProps": {}, "displayProps": { "label": "Claimable WETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png"], "statsItems": [] }, "balanceUSD": 0.5236832465550665 }, { "key": "2006750506", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x6b175474e89094c44da98b954eedeac495271d0f", "symbol": "DAI", "decimals": 18, "price": 0.998673, "balance": 2.523873481447286, "balanceRaw": "0x2306998f2fb1a600", "balanceUSD": 2.5205243013374057 }], "dataProps": {}, "displayProps": { "label": "Claimable DAI", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x6b175474e89094c44da98b954eedeac495271d0f.png"], "statsItems": [] }, "balanceUSD": 2.5205243013374057 }, { "key": "2385958076", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 1.568674624986141, "balanceRaw": "0x15c50d429e77d100", "balanceUSD": 1.5733806488610993 }], "dataProps": {}, "displayProps": { "label": "Claimable CRV", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xd533a949740bb3306d119cc777fa900ba034cd52.png"], "statsItems": [] }, "balanceUSD": 1.5733806488610993 }, { "key": "3976278423", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x674c6ad92fd080e4004b2312b45f796a192d27a0", "symbol": "USDN", "decimals": 18, "price": 0.03193451, "balance": 1.8476611959837477, "balanceRaw": "0x19a4361183e27a00", "balanceUSD": 0.05900415493975495 }], "dataProps": {}, "displayProps": { "label": "Claimable USDN", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x674c6ad92fd080e4004b2312b45f796a192d27a0.png"], "statsItems": [] }, "balanceUSD": 0.05900415493975495 }, { "key": "1749123916", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xdbdb4d16eda451d0503b854cf79d55697f90c8df", "symbol": "ALCX", "decimals": 18, "price": 20.5, "balance": 0.07912108681679443, "balanceRaw": "0x0119183591f53740", "balanceUSD": 1.6219822797442858 }], "dataProps": {}, "displayProps": { "label": "Claimable ALCX", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xdbdb4d16eda451d0503b854cf79d55697f90c8df.png"], "statsItems": [] }, "balanceUSD": 1.6219822797442858 }, { "key": "3968135450", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x3432b6a60d23ca0dfca7761b7ab56459d9c964d0", "symbol": "FXS", "decimals": 18, "price": 9.77, "balance": 2.600172029845313, "balanceRaw": "0x2415aaaf51d61600", "balanceUSD": 25.403680731588707 }], "dataProps": {}, "displayProps": { "label": "Claimable FXS", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x3432b6a60d23ca0dfca7761b7ab56459d9c964d0.png"], "statsItems": [] }, "balanceUSD": 25.403680731588707 }, { "key": "307646893", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x090185f2135308bad17527004364ebcc2d37e5f6", "symbol": "SPELL", "decimals": 18, "price": 0.00082551, "balance": 1138.891580348539, "balanceRaw": "0x3dbd4bb23885ec0000", "balanceUSD": 0.9401663884935224 }], "dataProps": {}, "displayProps": { "label": "Claimable SPELL", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x090185f2135308bad17527004364ebcc2d37e5f6.png"], "statsItems": [] }, "balanceUSD": 0.9401663884935224 }, { "key": "43614778", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xdb25f211ab05b1c97d595516f45794528a807ad8", "symbol": "EURS", "decimals": 2, "price": 1.098, "balance": 0.73, "balanceRaw": "0x49", "balanceUSD": 0.80154 }], "dataProps": {}, "displayProps": { "label": "Claimable EURS", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xdb25f211ab05b1c97d595516f45794528a807ad8.png"], "statsItems": [] }, "balanceUSD": 0.80154 }, { "key": "3544643143", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xa3bed4e1c75d00fa6f4e5e6922db7261b5e9acd2", "symbol": "MTA", "decimals": 18, "price": 0.02830033, "balance": 5.725149482216373, "balanceRaw": "0x4f73d11ef584b800", "balanceUSD": 0.16202361964605247 }], "dataProps": {}, "displayProps": { "label": "Claimable MTA", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xa3bed4e1c75d00fa6f4e5e6922db7261b5e9acd2.png"], "statsItems": [] }, "balanceUSD": 0.16202361964605247 }, { "key": "2620334396", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 1.0657203761249192, "balanceRaw": "0x0eca330920d24d80", "balanceUSD": 5.733575623552065 }], "dataProps": {}, "displayProps": { "label": "Claimable CVX", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b.png"], "statsItems": [] }, "balanceUSD": 5.733575623552065 }, { "key": "2867322121", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xc7283b66eb1eb5fb86327f08e1b5816b0720212b", "symbol": "TRIBE", "decimals": 18, "price": 0.281579, "balance": 0.32499002445468883, "balanceRaw": "0x048298b4932ad040", "balanceUSD": 0.09151036609592683 }], "dataProps": {}, "displayProps": { "label": "Claimable TRIBE", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc7283b66eb1eb5fb86327f08e1b5816b0720212b.png"], "statsItems": [] }, "balanceUSD": 0.09151036609592683 }, { "key": "3837752677", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x8207c1ffc5b6804f6024322ccf34f29c3541ae26", "symbol": "OGN", "decimals": 18, "price": 0.126405, "balance": 16.323937493863276, "balanceRaw": "0xe28a46a9a966a000", "balanceUSD": 2.063427318911787 }], "dataProps": {}, "displayProps": { "label": "Claimable OGN", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x8207c1ffc5b6804f6024322ccf34f29c3541ae26.png"], "statsItems": [] }, "balanceUSD": 2.063427318911787 }, { "key": "2807596439", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x31429d1856ad1377a8a0079410b297e1a9e214c2", "symbol": "ANGLE", "decimals": 18, "price": 0.04688273, "balance": 10.505698974243153, "balanceRaw": "0x91cbbd8e34f2e000", "balanceUSD": 0.49253584847071863 }], "dataProps": {}, "displayProps": { "label": "Claimable ANGLE", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x31429d1856ad1377a8a0079410b297e1a9e214c2.png"], "statsItems": [] }, "balanceUSD": 0.49253584847071863 }, { "key": "1720619985", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x03ab458634910aad20ef5f1c8ee96f1d6ac54919", "symbol": "RAI", "decimals": 18, "price": 2.77, "balance": 0.009266397329214106, "balanceRaw": "0x20ebbd4127ca9a", "balanceUSD": 0.025667920601923074 }], "dataProps": {}, "displayProps": { "label": "Claimable RAI", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x03ab458634910aad20ef5f1c8ee96f1d6ac54919.png"], "statsItems": [] }, "balanceUSD": 0.025667920601923074 }, { "key": "1366788456", "type": "contract-position", "appId": "votium", "groupId": "claimable", "network": "ethereum", "address": "0x378ba9b73309be80bf4c2c027aad799766a7ed5a", "tokens": [{ "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x6243d8cea23066d098a15582d81a598b4e8391f4", "symbol": "FLX", "decimals": 18, "price": 15.23, "balance": 0.009885940005111536, "balanceRaw": "0x231f35c64686f0", "balanceUSD": 0.15056286627784868 }], "dataProps": {}, "displayProps": { "label": "Claimable FLX", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x6243d8cea23066d098a15582d81a598b4e8391f4.png"], "statsItems": [] }, "balanceUSD": 0.15056286627784868 }], "meta": [] }] }, { "key": "1093565549", "address": "0x5a78917b84d3946f7e093ad4d9944fffffb451a9", "appId": "convex", "appName": "Convex", "appImage": "https://storage.googleapis.com/zapper-fi-assets/apps/convex.png", "network": "ethereum", "updatedAt": "2023-04-05T11:17:20.917Z", "balanceUSD": 158634.95600297087, "products": [{ "label": "Liqudity Pool Staking", "assets": [{ "key": "3286743372", "type": "contract-position", "appId": "convex", "groupId": "lp-farm", "network": "ethereum", "address": "0x0a760466e1b4621579a82a39cb56dda2f4e70f03", "tokens": [{ "metaType": "supplied", "type": "app-token", "appId": "convex", "price": 2041.0897593619661, "supply": 459498.95579424786, "symbol": "cvxsteCRV", "tokens": [{ "key": "1064272770", "type": "app-token", "appId": "curve", "price": 2041.0897593619661, "supply": 876013.8604957344, "symbol": "steCRV", "tokens": [{ "type": "base-token", "price": 1910.03, "symbol": "ETH", "address": "0x0000000000000000000000000000000000000000", "network": "ethereum", "decimals": 18, "balance": 9.705492210674134, "balanceRaw": "9705492210674132945", "balanceUSD": 18537.781287153914 }, { "key": "32421760", "type": "app-token", "appId": "lido", "price": 1908.1770397639923, "supply": 5913339.765892923, "symbol": "stETH", "tokens": [{ "type": "base-token", "price": 1913.05, "symbol": "ETH", "address": "0x0000000000000000000000000000000000000000", "network": "ethereum", "decimals": 18, "balance": 10.270413456553053, "balanceRaw": "10270413456553052041", "balanceUSD": 19647.814463058818 }], "address": "0xae7ab96520de3a18e5e111b5eaab095312d7fe84", "groupId": "steth", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [5898277.185437002], "liquidity": 11283699169.600256 }, "displayProps": { "label": "stETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 11283699169.600256 } }, { "label": "Share", "value": { "type": "pct", "value": 0.00017412564946779654 } }], "secondaryLabel": { "type": "dollar", "value": 1908.1770397639923 } }, "pricePerShare": [0.9974527794694297], "balance": 10.296641272598531, "balanceRaw": "10296641272598532524", "balanceUSD": 19647.814463058814 }], "address": "0x06325440d014e39736583c165c2963ba99faf14e", "groupId": "stable-pool", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0.21168150283419623, "fee": 0.04, "volume": 25924067.037512254, "reserves": [454455.19911060564, 482135.481450685], "liquidity": 1788022919.7169855, "swapAddress": "0xdc24316b9ae028f1497c275eb9192a3ea0f67022" }, "displayProps": { "label": "ETH / stETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 1788022919.7169855 } }, { "label": "Volume", "value": { "type": "dollar", "value": 25924067.037512254 } }, { "label": "APY", "value": { "type": "pct", "value": 0.21168150283419623 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.04 } }, { "label": "Share", "value": { "type": "pct", "value": 0.0021356323416847965 } }], "tertiaryLabel": "0.212% APY", "secondaryLabel": "48% / 51%" }, "pricePerShare": [0.5187762655415411, 0.5503742614047745], "balance": 18.70843532238844, "balanceRaw": "18708435322388441000", "balanceUSD": 38185.59575021273 }], "address": "0x9518c9063eb0262d791f38d8d6eb0aca33c63ed0", "groupId": "deposit", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [459498.95579424786], "liquidity": 937878613.109156 }, "displayProps": { "label": "ETH / stETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 937878613.109156 } }, { "label": "Share", "value": { "type": "pct", "value": 0.004071485927547049 } }], "secondaryLabel": { "type": "dollar", "value": 2041.0897593619661 } }, "pricePerShare": [1], "key": "350280079", "balance": 18.70843532238844, "balanceRaw": "18708435322388441000", "balanceUSD": 38185.59575021273 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 0.07143160521909107, "balanceRaw": "71431605219091070", "balanceUSD": 0.07164590003474834 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x5a98fcbea516cf06857215779fd812ca3bef1b32", "symbol": "LDO", "decimals": 18, "price": 2.68, "balance": 48.59646622961956, "balanceRaw": "48596466229619558828", "balanceUSD": 130.23852949538042 }], "dataProps": { "liquidity": 937874575.8413118, "apy": 1.3900500774468583, "isActive": true }, "displayProps": { "label": "ETH / stETH", "tertiaryLabel": "1.390% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x0000000000000000000000000000000000000000.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 937874575.8413118 } }, { "label": "APY", "value": { "type": "pct", "value": 1.3900500774468583 } }] }, "balanceUSD": 38315.90592560814 }, { "key": "2353944367", "type": "contract-position", "appId": "convex", "groupId": "lp-farm", "network": "ethereum", "address": "0x3382607d00cfb668abab80d8ee781a2720cbc9ea", "tokens": [{ "metaType": "supplied", "type": "app-token", "appId": "convex", "price": 87.96011023400455, "supply": 19604.689094358993, "symbol": "cvxTOKEETH-f", "tokens": [{ "key": "3486773614", "type": "app-token", "appId": "curve", "price": 87.96011023400455, "supply": 20549.717779710332, "symbol": "TOKEETH-f", "tokens": [{ "type": "base-token", "price": 1910.03, "symbol": "WETH", "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2", "network": "ethereum", "decimals": 18, "balance": 1.0952500676321688, "balanceRaw": "1095250067632168826", "balanceUSD": 2091.960486679471 }, { "type": "base-token", "price": 1.007, "symbol": "TOKE", "address": "0x2e9d63788249371f1dfc918a52f8d799f4a38c94", "network": "ethereum", "decimals": 18, "balance": 2089.4883485066216, "balanceRaw": "2089488348506621618845", "balanceUSD": 2104.114766946168 }], "address": "0x7ea4ad8c803653498bf6ac1d2debc04dce8fd2ad", "groupId": "factory-crypto-pool", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "fee": 0.44781757, "volume": 0, "reserves": [471.80403103871845, 900094.9233129302], "liquidity": 1807555.441181004, "swapAddress": "0xe0e970a99bc4f53804d8145bebbc7ebc9422ba7f" }, "displayProps": { "label": "WETH / TOKE", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x2e9d63788249371f1dfc918a52f8d799f4a38c94.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 1807555.441181004 } }, { "label": "Volume", "value": { "type": "dollar", "value": 0 } }, { "label": "APY", "value": { "type": "pct", "value": 0 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.44781757 } }, { "label": "Share", "value": { "type": "pct", "value": 0.23214088807611047 } }], "secondaryLabel": "49% / 50%" }, "pricePerShare": [0.02295914893315722, 43.800841109440185], "balance": 47.70429735095394, "balanceRaw": "47704297350953934685", "balanceUSD": 4196.07525362564 }], "address": "0xe0979fc4bc4073018e88509c9b98ebd35768e2b2", "groupId": "deposit", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [19604.689094358993], "liquidity": 1724430.6138432038 }, "displayProps": { "label": "WETH / TOKE", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x2e9d63788249371f1dfc918a52f8d799f4a38c94.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 1724430.6138432038 } }, { "label": "Share", "value": { "type": "pct", "value": 0.2433310577961691 } }], "secondaryLabel": { "type": "dollar", "value": 87.96011023400455 } }, "pricePerShare": [1], "key": "3856725650", "balance": 47.70429735095394, "balanceRaw": "47704297350953934685", "balanceUSD": 4196.07525362564 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 44.387527321139665, "balanceRaw": "44387527321139665215", "balanceUSD": 44.520689903103076 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 0.9545696761949386, "balanceRaw": "954569676194938597", "balanceUSD": 5.1355848579287695 }], "dataProps": { "liquidity": 1724430.6138432038, "apy": 25.55180496451881, "isActive": true }, "displayProps": { "label": "WETH / TOKE", "tertiaryLabel": "25.552% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x2e9d63788249371f1dfc918a52f8d799f4a38c94.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 1724430.6138432038 } }, { "label": "APY", "value": { "type": "pct", "value": 25.55180496451881 } }] }, "balanceUSD": 4245.731528386671 }, { "key": "250325508", "type": "contract-position", "appId": "convex", "groupId": "lp-farm", "network": "ethereum", "address": "0x5d02ecd9b83f1187e92ad5be3d1bd2915ca03699", "tokens": [{ "metaType": "supplied", "type": "app-token", "appId": "convex", "price": 3880.235886079123, "supply": 1500.713960625334, "symbol": "cvxcbETH/ETH-f", "tokens": [{ "key": "3645062360", "type": "app-token", "appId": "curve", "price": 3880.235886079123, "supply": 2102.3001677278826, "symbol": "cbETH/ETH-f", "tokens": [{ "type": "base-token", "price": 1910.03, "symbol": "WETH", "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2", "network": "ethereum", "decimals": 18, "balance": 14.954280368002395, "balanceRaw": "14954280368002396989", "balanceUSD": 28563.124131295615 }, { "type": "base-token", "price": 1942.26, "symbol": "cbETH", "address": "0xbe9895146f7af43049ca1c1ae358b0541ea49704", "network": "ethereum", "decimals": 18, "balance": 14.82140523436842, "balanceRaw": "14821405234368419080", "balanceUSD": 28787.022530504408 }], "address": "0x5b6c539b224014a09b3388e51caaa8e354c959c8", "groupId": "factory-crypto-pool", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 4.566511472798781, "fee": 0.03002809, "volume": 3398731.3120125313, "reserves": [2127.080071224793, 2108.180061210341], "liquidity": 8157420.554127889, "swapAddress": "0x5fae7e604fc3e24fd43a72867cebac94c65b404a" }, "displayProps": { "label": "WETH / cbETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xbe9895146f7af43049ca1c1ae358b0541ea49704.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 8157420.554127889 } }, { "label": "Volume", "value": { "type": "dollar", "value": 3398731.3120125313 } }, { "label": "APY", "value": { "type": "pct", "value": 4.566511472798781 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.03002809 } }, { "label": "Share", "value": { "type": "pct", "value": 0.7030426625825882 } }], "tertiaryLabel": "4.567% APY", "secondaryLabel": "49% / 50%" }, "pricePerShare": [1.011787043485656, 1.0027968857980987], "balance": 14.780067074672322, "balanceRaw": "14780067074672321865", "balanceUSD": 57350.14666180003 }], "address": "0x06a2c4431fb5dbfecbcba15154dd53e374c14292", "groupId": "deposit", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [1500.713960625334], "liquidity": 5823124.164758353 }, "displayProps": { "label": "WETH / cbETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xbe9895146f7af43049ca1c1ae358b0541ea49704.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 5823124.164758353 } }, { "label": "Share", "value": { "type": "pct", "value": 0.9848690331709582 } }], "secondaryLabel": { "type": "dollar", "value": 3880.235886079123 } }, "pricePerShare": [1], "key": "1524896419", "balance": 14.780067074672322, "balanceRaw": "14780067074672321865", "balanceUSD": 57350.14666180003 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 124.2510587133306, "balanceRaw": "124251058713330591097", "balanceUSD": 124.62381188947057 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 2.672063528674546, "balanceRaw": "2672063528674546326", "balanceUSD": 14.375701784269058 }], "dataProps": { "liquidity": 5823124.164758353, "apy": 5.457391474951279, "isActive": true }, "displayProps": { "label": "WETH / cbETH", "tertiaryLabel": "5.457% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xbe9895146f7af43049ca1c1ae358b0541ea49704.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 5823124.164758353 } }, { "label": "APY", "value": { "type": "pct", "value": 5.457391474951279 } }] }, "balanceUSD": 57489.14617547377 }, { "key": "389262145", "type": "contract-position", "appId": "convex", "groupId": "lp-farm", "network": "ethereum", "address": "0x65c8aa24db76e870dedfc35701eff84de405d1ba", "tokens": [{ "metaType": "supplied", "type": "app-token", "appId": "convex", "price": 3942.567802384891, "supply": 3072.489947072498, "symbol": "cvxrETH-f", "tokens": [{ "key": "3896902378", "type": "app-token", "appId": "curve", "price": 3942.567802384891, "supply": 3198.6245720694137, "symbol": "rETH-f", "tokens": [{ "type": "base-token", "price": 1910.03, "symbol": "WETH", "address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2", "network": "ethereum", "decimals": 18, "balance": 5.838250193057763, "balanceRaw": "5838250193057763810", "balanceUSD": 11151.233016246118 }, { "type": "base-token", "price": 2033.32, "symbol": "rETH", "address": "0xae78736cd615f374d3085123a210448e74fc6393", "network": "ethereum", "decimals": 18, "balance": 7.057608327010421, "balanceRaw": "7057608327010421014", "balanceUSD": 14350.376163476829 }], "address": "0x6c38ce8984a890f5e46e6df6117c26b3f1ecfc9c", "groupId": "factory-crypto-pool", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 2.0228259387515957, "fee": 0.05179343, "volume": 1349377.3518288753, "reserves": [2887.0716135749894, 3490.0560933258826], "liquidity": 12610794.24975802, "swapAddress": "0x0f3159811670c117c372428d4e69ac32325e4d0f" }, "displayProps": { "label": "WETH / rETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xae78736cd615f374d3085123a210448e74fc6393.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 12610794.24975802 } }, { "label": "Volume", "value": { "type": "dollar", "value": 1349377.3518288753 } }, { "label": "APY", "value": { "type": "pct", "value": 2.0228259387515957 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.05179343 } }, { "label": "Share", "value": { "type": "pct", "value": 0.2022204840921283 } }], "tertiaryLabel": "2.023% APY", "secondaryLabel": "43% / 56%" }, "pricePerShare": [0.9025978349522717, 1.0911115120546708], "balance": 6.468274093928536, "balanceRaw": "6468274093928536330", "balanceUSD": 25501.60917972295 }], "address": "0x96c01b43853be9e27363b15be620769437cba345", "groupId": "deposit", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0, "reserves": [3072.489947072498], "liquidity": 12113499.93847929 }, "displayProps": { "label": "WETH / rETH", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xae78736cd615f374d3085123a210448e74fc6393.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 12113499.93847929 } }, { "label": "Share", "value": { "type": "pct", "value": 0.21052222156468173 } }], "secondaryLabel": { "type": "dollar", "value": 3942.567802384891 } }, "pricePerShare": [1], "key": "3874341150", "balance": 6.468274093928536, "balanceRaw": "6468274093928536330", "balanceUSD": 25501.60917972295 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 178.9059524707007, "balanceRaw": "178905952470700696820", "balanceUSD": 179.44267032811277 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 3.8474365982078558, "balanceRaw": "3847436598207855508", "balanceUSD": 20.699208898358265 }], "dataProps": { "liquidity": 12113499.93847929, "apy": 7.349959363126213, "isActive": true }, "displayProps": { "label": "WETH / rETH", "tertiaryLabel": "7.350% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xae78736cd615f374d3085123a210448e74fc6393.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 12113499.93847929 } }, { "label": "APY", "value": { "type": "pct", "value": 7.349959363126213 } }] }, "balanceUSD": 25701.75105894942 }], "meta": [] }, { "label": "Vote Locked CVX", "assets": [{ "key": "2134157525", "type": "contract-position", "appId": "convex", "groupId": "voting-escrow", "network": "ethereum", "address": "0x72a19342e8f1838460ebfccef09f6585e32db86e", "tokens": [{ "metaType": "supplied", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 312.73310595863126, "balanceRaw": "312733105958631263605", "balanceUSD": 1682.504110057436 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7", "symbol": "cvxCRV", "decimals": 18, "price": 0.863239, "balance": 32.86400547267996, "balanceRaw": "32864005472679961166", "balanceUSD": 28.369491220230778 }], "dataProps": {}, "displayProps": { "label": "Voting Escrow CVX", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7.png"], "statsItems": [] }, "balanceUSD": 1710.873601277667 }], "meta": [] }, { "label": "cvxCRV Staking Wrapped", "assets": [{ "key": "2429584836", "type": "contract-position", "appId": "convex", "groupId": "cvx-crv-staking-wrapped", "network": "ethereum", "address": "0xaa0c3f5f7dfd688c6e646f66cd2a6b66acdbe434", "tokens": [{ "metaType": "supplied", "type": "base-token", "network": "ethereum", "address": "0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7", "symbol": "cvxCRV", "decimals": 18, "price": 0.863239, "balance": 35772.25536697727, "balanceRaw": "35772255366977265405529", "balanceUSD": 30880.00595073409 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0xd533a949740bb3306d119cc777fa900ba034cd52", "symbol": "CRV", "decimals": 18, "price": 1.003, "balance": 90.40351881776067, "balanceRaw": "90403518817760670000", "balanceUSD": 90.67472937421394 }, { "metaType": "claimable", "type": "base-token", "network": "ethereum", "address": "0x4e3fbd56cd56c3e72c1403e103b45db9da5b9d2b", "symbol": "CVX", "decimals": 18, "price": 5.38, "balance": 11.87570639491061, "balanceRaw": "11875706394910610000", "balanceUSD": 63.89130040461908 }, { "metaType": "claimable", "type": "app-token", "appId": "curve", "price": 1.0244459210539945, "supply": 421897991.3237883, "symbol": "3Crv", "tokens": [{ "type": "base-token", "price": 0.998673, "symbol": "DAI", "address": "0x6b175474e89094c44da98b954eedeac495271d0f", "network": "ethereum", "decimals": 18, "balance": 54.72231405038077, "balanceRaw": "54722314050380767933", "balanceUSD": 54.649697539635916 }, { "type": "base-token", "price": 0.998615, "symbol": "USDC", "address": "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48", "network": "ethereum", "decimals": 6, "balance": 52.399424, "balanceRaw": "52399424", "balanceUSD": 52.32685079776 }, { "type": "base-token", "price": 0.999991, "symbol": "USDT", "address": "0xdac17f958d2ee523a2206206994597c13d831ec7", "network": "ethereum", "decimals": 6, "balance": 29.999454, "balanceRaw": "29999454", "balanceUSD": 29.999184004914 }], "address": "0x6c3f90f043a72fa612cbac8115ee7e52bde6e490", "groupId": "stable-pool", "network": "ethereum", "decimals": 18, "dataProps": { "apy": 0.2406430413075863, "fee": 0.01, "volume": 28495543.0894512, "reserves": [172670170.18599665, 165340549.179532, 94659938.8629], "liquidity": 432211676.31252843, "swapAddress": "0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7" }, "displayProps": { "label": "DAI / USDC / USDT", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x6b175474e89094c44da98b954eedeac495271d0f.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48.png", "https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0xdac17f958d2ee523a2206206994597c13d831ec7.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 432211676.31252843 } }, { "label": "Volume", "value": { "type": "dollar", "value": 28495543.0894512 } }, { "label": "APY", "value": { "type": "pct", "value": 0.2406430413075863 } }, { "label": "Fee", "value": { "type": "pct", "value": 0.01 } }, { "label": "Share", "value": { "type": "pct", "value": 0.00003169181682709587 } }], "tertiaryLabel": "0.241% APY", "secondaryLabel": "39% / 38% / 21%" }, "pricePerShare": [0.40926995088127793, 0.3918969812127888, 0.22436688680570804], "key": "3597621596", "balance": 133.70713860753182, "balanceRaw": "133707138607531820000", "balanceUSD": 136.97573276228704 }], "dataProps": { "liquidity": 176568112.71908423, "apy": 0, "isActive": true }, "displayProps": { "label": "cvxCRV", "tertiaryLabel": "0.000% APY", "images": ["https://storage.googleapis.com/zapper-fi-assets/tokens/ethereum/0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7.png"], "statsItems": [{ "label": "Liquidity", "value": { "type": "dollar", "value": 176568112.71908423 } }] }, "balanceUSD": 31171.54771327521 }], "meta": [] }] }]

  const APP_GROUPS = F2_MARKETS.filter(m => !!m.zapperAppGroup).map(m => m.zapperAppGroup);

  try {
    const validCache = await getCacheFromRedis(cacheKey, fresh !== 'true', 60000);
    if (validCache) {
      res.status(200).json(validCache);
      return
    }
    
    const pointsData = await getZapperRemainingPoints();
    const data = await getZapperApps([escrow]);
    // const data = pointsData.hasPoints ? await getZapperApps(activeEscrows) : [];

    let appGroupPositions = formatAndFilterZapperData(data, APP_GROUPS);

    const resultData = {
      timestamp: +(new Date()),
      appGroupPositions,
      rateLimited: !pointsData.hasPoints,
    }

    await redisSetWithTimestamp(cacheKey, resultData);

    res.status(200).json(resultData)
  } catch (err) {
    console.error(err);
    // if an error occured, try to return last cached results
    try {
      const cache = await getCacheFromRedis(cacheKey, false);
      if (cache) {
        console.log('Api call failed, returning last cache found');
        res.status(200).json(cache);
      }
    } catch (e) {
      console.error(e);
    }
  }
}